<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/index.html::home(~{::body})}">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Pet Shop</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
</head>

<body>
<div class="container-lg main-content px-3">
    <!-- BREADCRUMB -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-white mb-0 p-2 rounded-3">
            <li class="breadcrumb-item">
                <a href="/trang-chu" class="text-decoration-none text-danger d-flex align-items-center">
                    <i class="fas fa-home me-2"></i>
                    Trang chủ
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Quên mật khẩu</li>
        </ol>
    </nav>
    <div class="row mt-3">
        <div class="d-flex justify-content-center position-relative">
            <img src="/images/background/login-form-bg.png" class="w-100" alt="login-form">
            <div class="col-6 card shadow border-0"
                 style="position: absolute; top: 58%; left: 50%; transform: translate(-50%, -50%)">
                <div class="card-body">
                    <h3 class="text-center">Quên mật khẩu</h3>
                    <form action="/login" method="post">
                        <h5 class="alert font-resp"
                            th:if="${message}"
                            th:text="${message}"
                            th:classappend="${loginStatus == true ? 'alert-success' : 'alert-danger'}"></h5>
                        <div class="form-floating mb-3">
                            <input class="form-control"
                                   id="username"
                                   name="username"
                                   placeholder="Tên đăng nhập"
                                   required
                                   type="text"/>
                            <label for="username">Tên đăng nhập</label>
                        </div>
                        <code>
                            <p class="text-danger">Vui lòng nhập tên đăng nhập của bạn để xác nhận tài khoản.</p>
                        </code>
                        <div class="d-flex justify-content-center gap-3 mt-4">
                            <a id="forgotButton"
                               class="btn font-resp button-image"
                               onclick="forgot()"
                               style="background: #aaccff">Xác nhận tài khoản</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div
            class="modal fade"
            data-bs-backdrop="static"
            id="countdownModal"
            tabindex="-1"
            aria-labelledby="modalLabel"
            aria-hidden="true"
    >
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Thông báo</h5>
                </div>
                <div class="modal-body">
                    <p id="modal-message"></p>
                    <div
                            class="progress"
                            role="progressbar"
                            aria-valuemin="0"
                            aria-valuemax="100"
                    >
                        <div
                                id="progressBar"
                                class="progress-bar bg-danger progress-bar-striped progress-bar-animated"
                                style="width: 0"
                        ></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function showModal(message) {
        document.getElementById("modalMessage").innerText = message; // Cập nhật thông điệp
        var myModal = new bootstrap.Modal(
            document.getElementById("notificationModal")
        );
        myModal.show(); // Hiển thị modal
    }

    function forgot() {
        const username = document.getElementById("username").value;
        const forgotButton = document.getElementById("forgotButton");
        forgotButton.innerHTML =
            '<i class="fa fa-spinner fa-spin"></i> Đang xử lý...';
        forgotButton.disabled = true;
        if (!username) {
            showModal("Vui lòng nhập tên đăng nhập.");
            forgotButton.disabled = false;
            forgotButton.innerHTML = "Xác nhận tài khoản";
            return;
        }

        // Fetch request to backend
        fetch(`/api/user/forgot-password/${username}`)
            .then((response) => {
                if (!response.ok) {
                    throw new Error('Tài khoản không tồn tại'); // Ném lỗi nếu không thành công
                }
                return response.json(); // Chuyển đổi phản hồi thành JSON
            })
            .then((data) => {
                console.log(data);
                Swal.fire({
                    title: "Đang xử lý...",
                    text: "Vui lòng chờ trong giây lát...",
                    icon: "info",
                    timer: 2000,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    willClose: () => {
                        window.location.href = "/sendMail"; // Chuyển hướng
                    },
                });
            })
            .catch((error) => {
                console.error("Error:", error);
                alert(error.message); // Hiển thị thông báo lỗi
            });
    }

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>